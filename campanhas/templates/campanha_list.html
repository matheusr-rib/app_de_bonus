{% extends 'base.html' %}
{% block title %}Campanhas{% endblock %}

{% block content %}
<h2>Campanhas Cadastradas</h2>

<!-- üîç Filtros -->
<form method="get" style="display: flex; gap: 1rem; align-items: flex-end; margin-bottom: 1.5rem; flex-wrap: wrap;">
  <div>
    <label for="id_q">üîç Buscar por nome da campanha/banco</label><br>
    <input type="text" name="q" id="id_q" value="{{ q }}" placeholder="Digite aqui..." style="padding: 6px; border-radius: 6px; border: 1px solid #ccc; min-width: 250px;">
  </div>

  <div>
    <label for="id_status">üìå Filtrar por status</label><br>
    <select name="status" id="id_status" style="padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
      <option value="todas" {% if status == 'todas' %}selected{% endif %}>Todas</option>
      <option value="ativa" {% if status == 'ativa' %}selected{% endif %}>Ativa</option>
      <option value="encerrada" {% if status == 'encerrada' %}selected{% endif %}>Encerrada</option>
      <option value="em an√°lise" {% if status == 'em an√°lise' %}selected{% endif %}>Em an√°lise</option>
    </select>
  </div>

  <div>
    <button type="submit" style="padding: 6px 14px; background: #4c51bf; color: #fff; border: none; border-radius: 6px;">Filtrar</button>
  </div>
</form>

<!-- Estilo para cards -->
<style>
  .grid-campanhas {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
  }

  .card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
    padding: 1.2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .card h3 {
    margin-top: 0;
    font-size: 1.2rem;
    color: #333;
  }

  .card p {
    margin: 0.3rem 0;
    font-size: 0.95rem;
    color: #555;
  }

  .detalhes-hover {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.4s ease;
    background: #f7f2fa;
    margin-top: 1rem;
    padding: 0 1rem;
    border-radius: 8px;
  }

  .card:hover .detalhes-hover {
    max-height: 500px;
    padding: 1rem;
  }

  .detalhes-hover h4 {
    margin-top: 0;
    color: #6200ea;
    font-size: 1rem;
    border-bottom: 1px solid #ccc;
    padding-bottom: 4px;
  }

  .detalhes-hover p {
    margin-bottom: 6px;
    font-size: 0.9rem;
  }

  .faixa-meta {
    padding-left: 1rem;
    list-style: disc;
    margin-bottom: 1rem;
  }
</style>

<!-- Lista de campanhas -->
<div class="grid-campanhas">
  {% for campanha in campanhas %}
    <div class="card">
      <h3>{{ campanha.campanha }}</h3>
      <p><strong>Banco:</strong> {{ campanha.banco }}</p>
      <p><strong>Status:</strong> {{ campanha.status_manual }}</p>
      <p><strong>Recebido:</strong>
        {% if campanha.faixas.exists %}
          Possui meta
        {% else %}
          {{ campanha.recebido|default:"-" }}
          {{ campanha.tipo_valor_recebido }}
        {% endif %}
      </p>
      <p><strong>Parametrizado:</strong> {{ campanha.parametrizado_wb|default:"-" }}</p>

      <div class="detalhes-hover">
        <h4>Detalhes adicionais</h4>
        <p><strong>Nomenclatura WB:</strong> {{ campanha.nomenclatura_wb }}</p>

        {% if campanha.faixas.exists %}
          <p><strong>Faixas:</strong></p>
          <ul class="faixa-meta">
            {% for faixa in campanha.faixas.all %}
              <li>
                {% if faixa.faixa_final %}
                  R$ {{ faixa.faixa_inicial|floatformat:2 }} a R$ {{ faixa.faixa_final|floatformat:2 }} ‚Üí Comiss√£o: {{ faixa.valor_recebido|floatformat:2 }} {{ faixa.tipo_valor }}
                {% else %}
                  Acima de R$ {{ faixa.faixa_inicial|floatformat:2 }} ‚Üí Comiss√£o: {{ faixa.valor_recebido|floatformat:2 }} {{ faixa.tipo_valor }}
                {% endif %}
                {% if faixa.faixa_garantida %}
                  <em>(Faixa Garantida)</em>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p><strong>Faixas:</strong> Nenhuma cadastrada</p>
        {% endif %}

        <p><strong>Vig√™ncia:</strong> {{ campanha.vigencia_inicio|date:"d/m/Y" }} at√© {{ campanha.vigencia_fim|date:"d/m/Y" }}</p>
        <p><strong>Periodicidade:</strong> {{ campanha.periodicidade_repasses }}</p>
        <p><strong>Previs√£o Pagamento:</strong> {{ campanha.previsao_pagamento }}</p>
        <p><strong>Par√¢metro Avalia√ß√£o:</strong> {{ campanha.parametro_avaliacao }}</p>
        <p><strong>Crit√©rio Apura√ß√£o:</strong> {{ campanha.criterio_apuracao }}</p>
        {% if campanha.observacoes %}
          <p><strong>Observa√ß√µes:</strong> {{ campanha.observacoes }}</p>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p>Nenhuma campanha cadastrada ainda.</p>
  {% endfor %}
</div>
{% endblock %}